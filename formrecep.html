<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Formulário Escala Diária</title>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; background: #f4f4f4; }
  .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
  
  /* Header com logo e texto */
  .header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 25px;
  }
  .header img {
    height: 60px;
    max-width: 150px;
    object-fit: contain;
  }
  .header h2 {
    margin: 0;
    font-weight: normal;
    font-size: 24px;
    text-transform: uppercase;
    flex-grow: 1;
    text-align: center;
  }

  .linha-principal { display: flex; gap: 20px; margin-bottom: 20px; }
  .linha-principal > div { flex: 1; display: flex; flex-direction: column; }
  label { font-weight: bold; margin-bottom: 5px; }
  input[type=date], input[type=text], select { padding: 8px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc; }
  input[readonly] { background: #eee; cursor: not-allowed; }
  #turno { max-width: 140px; }
  .select-duplo { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
  .select-container { flex: 1; display: flex; flex-direction: column; }
  select[multiple] { height: 140px; border-radius: 4px; border: 1px solid #ccc; padding: 5px; font-size: 14px; }
  .botoes-mover { display: flex; flex-direction: column; gap: 10px; }
  .botoes-mover button { width: 40px; height: 30px; font-weight: bold; font-size: 18px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  .botoes-mover button:disabled { background: #ccc; cursor: default; }
  button[type=submit] { width: 100%; background: #28a745; color: white; padding: 12px; font-size: 16px; border: none; border-radius: 6px; cursor: pointer; }
  button[type=submit]:hover { background: #218838; }
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <img src="https://www.alphainstituto.com.br/wp-content/uploads/2019/03/cropped-logo2-1.jpg" alt="Alpha Instituto" />
    <h2>Preencher Escala Diária</h2>
    <img src="https://www.mairiporaeducasim.com.br/assets/img/prefeitura-mairipora.png" alt="Prefeitura de Mairiporã" />
  </div>

  <form id="formEscala">

    <div class="linha-principal">
      <div>
        <label for="data">Data:</label>
        <input type="date" id="data" required />
      </div>
      <div>
        <label for="setor">Setor:</label>
        <input type="text" id="setor" value="Recepção" readonly />
      </div>
      <div>
        <label for="turno">Turno:</label>
        <select id="turno" required>
          <option value="">Selecione</option>
          <option value="Diurno">Diurno</option>
          <option value="Noturno">Noturno</option>
        </select>
      </div>
    </div>

    <!-- Recepcionistas -->
    <label>Recepcionistas:</label>
    <div class="select-duplo">
      <div class="select-container">
        <label>Disponíveis</label>
        <select id="recepDisponiveis" multiple></select>
      </div>
      <div class="botoes-mover">
        <button type="button" id="btnRecepAdd">&gt;</button>
        <button type="button" id="btnRecepRemove">&lt;</button>
      </div>
      <div class="select-container">
        <label>Selecionados</label>
        <select id="recepSelecionados" multiple name="recepcionistasSelecionados"></select>
      </div>
    </div>

    <!-- Responsáveis pela Remoção -->
    <label>Responsáveis pela Remoção do Dia:</label>
    <div class="select-duplo">
      <div class="select-container">
        <label>Disponíveis</label>
        <select id="remocaoDisponiveis" multiple></select>
      </div>
      <div class="botoes-mover">
        <button type="button" id="btnRemocaoAdd">&gt;</button>
        <button type="button" id="btnRemocaoRemove">&lt;</button>
      </div>
      <div class="select-container">
        <label>Selecionados</label>
        <select id="remocaoSelecionados" multiple name="remocaoSelecionados"></select>
      </div>
    </div>

    <!-- Auxiliar de Atendimento -->
    <label>Auxiliar de Atendimento:</label>
    <div class="select-duplo">
      <div class="select-container">
        <label>Disponíveis</label>
        <select id="auxiliarDisponiveis" multiple></select>
      </div>
      <div class="botoes-mover">
        <button type="button" id="btnAuxAdd">&gt;</button>
        <button type="button" id="btnAuxRemove">&lt;</button>
      </div>
      <div class="select-container">
        <label>Selecionados</label>
        <select id="auxiliarSelecionados" multiple name="auxiliarSelecionados"></select>
      </div>
    </div>

    <!-- Supervisor -->
    <label for="supervisorSelect">Supervisor Responsável:</label>
    <select id="supervisorSelect" required></select>

    <button type="submit">Salvar e Visualizar Painel</button>
  </form>
</div>

<script>
  // URLs CSV (output=csv)
  const urlRecep = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSBrPbPiu67iZGvoiq4wMxNdHQgeF74Bbc_q3GlYfrJZx6MHOkd0ndkvZmXSwlxOplBpvrzEXjOnpCD/pub?output=csv';
  const urlAuxiliar = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTe1l08kYGKrlFuT3e--rDHD8cvtA0yf4pPyBnvbSvLcQ9OqXjKp0nupKhw6G6FvMJyMg9wlAmf50hO/pub?output=csv';
  const urlSupervisor = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSrk7y_e0JFeoqd2fxxUjHRpTxFf1PBmdCzCK5dwTcrTyorPJfbWjGN5smrd5bc8fAKzcJFXVAS0n9t/pub?output=csv';

  async function fetchNomes(url) {
    const res = await fetch(url);
    const txt = await res.text();
    const linhas = txt.split('\n').slice(1);
    return linhas.map(l => l.split(',')[0].trim()).filter(n => n);
  }

  function popularSelect(selectElem, nomes) {
    selectElem.innerHTML = '';
    nomes.forEach(nome => {
      const option = document.createElement('option');
      option.value = nome;
      option.textContent = nome;
      selectElem.appendChild(option);
    });
  }

  function moverOpcoes(fromSelect, toSelect) {
    const selecionados = Array.from(fromSelect.selectedOptions);
    selecionados.forEach(opt => toSelect.appendChild(opt));
  }

  document.getElementById('btnRecepAdd').onclick = () => moverOpcoes(
    document.getElementById('recepDisponiveis'),
    document.getElementById('recepSelecionados')
  );
  document.getElementById('btnRecepRemove').onclick = () => moverOpcoes(
    document.getElementById('recepSelecionados'),
    document.getElementById('recepDisponiveis')
  );

  document.getElementById('btnRemocaoAdd').onclick = () => moverOpcoes(
    document.getElementById('remocaoDisponiveis'),
    document.getElementById('remocaoSelecionados')
  );
  document.getElementById('btnRemocaoRemove').onclick = () => moverOpcoes(
    document.getElementById('remocaoSelecionados'),
    document.getElementById('remocaoDisponiveis')
  );

  document.getElementById('btnAuxAdd').onclick = () => moverOpcoes(
    document.getElementById('auxiliarDisponiveis'),
    document.getElementById('auxiliarSelecionados')
  );
  document.getElementById('btnAuxRemove').onclick = () => moverOpcoes(
    document.getElementById('auxiliarSelecionados'),
    document.getElementById('auxiliarDisponiveis')
  );

  window.onload = async () => {
    const nomesRecep = await fetchNomes(urlRecep);
    const nomesAux = await fetchNomes(urlAuxiliar);
    const nomesSup = await fetchNomes(urlSupervisor);

    popularSelect(document.getElementById('recepDisponiveis'), nomesRecep);
    popularSelect(document.getElementById('remocaoDisponiveis'), nomesRecep);
    popularSelect(document.getElementById('auxiliarDisponiveis'), nomesAux);
    popularSelect(document.getElementById('supervisorSelect'), nomesSup);

    // LocalStorage
    const dados = JSON.parse(localStorage.getItem('escalaDiaria')) || {};

    document.getElementById('data').value = dados.data || '';
    document.getElementById('setor').value = dados.setor || 'Recepção';
    document.getElementById('turno').value = dados.turno || '';

    function setSelecionados(disponiveisId, selecionadosId, nomesSelecionados) {
      if (!nomesSelecionados) return;
      const disp = document.getElementById(disponiveisId);
      const sel = document.getElementById(selecionadosId);
      nomesSelecionados.forEach(nome => {
        for (let i = 0; i < disp.options.length; i++) {
          if (disp.options[i].value === nome) {
            sel.appendChild(disp.options[i]);
            break;
          }
        }
      });
    }

    setSelecionados('recepDisponiveis', 'recepSelecionados', dados.recepcionistas);
    setSelecionados('remocaoDisponiveis', 'remocaoSelecionados', dados.responsavelRemocao);
    setSelecionados('auxiliarDisponiveis', 'auxiliarSelecionados', dados.auxiliares);

    if (dados.supervisores) {
      const sup = document.getElementById('supervisorSelect');
      for (let i = 0; i < sup.options.length; i++) {
        if (sup.options[i].value === dados.supervisores) {
          sup.selectedIndex = i;
          break;
        }
      }
    }
  };

  document.getElementById('formEscala').addEventListener('submit', e => {
    e.preventDefault();

    function pegarSelecionados(id) {
      return Array.from(document.getElementById(id).options).map(o => o.value);
    }

    const novaEscala = {
      data: document.getElementById('data').value,
      setor: document.getElementById('setor').value,
      turno: document.getElementById('turno').value,
      recepcionistas: pegarSelecionados('recepSelecionados'),
      responsavelRemocao: pegarSelecionados('remocaoSelecionados'),
      auxiliares: pegarSelecionados('auxiliarSelecionados'),
      supervisores: document.getElementById('supervisorSelect').value
    };

    if (!novaEscala.data || !novaEscala.turno || novaEscala.recepcionistas.length === 0 || !novaEscala.supervisores) {
      alert('Por favor, preencha Data, Turno, selecione pelo menos uma Recepcionista e um Supervisor.');
      return;
    }

    localStorage.setItem('escalaDiaria', JSON.stringify(novaEscala));
    window.location.href = 'painel.html';
  });
</script>

</body>
</html>
