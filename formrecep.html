<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Formulário Escala Diária</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px 20px 80px;
      background: #f4f4f4;
      min-height: 100vh;
      position: relative;
      margin: 0;
    }
    .container {
      background: #fff;
      max-width: 700px;
      margin: auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    .cabecalho {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .cabecalho img {
      height: 60px;
      width: auto;
      object-fit: contain;
    }
    .cabecalho h2 {
      flex-grow: 1;
      text-align: center;
      margin: 0;
      font-size: 28px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }
    .linha {
      display: flex;
      margin-bottom: 20px;
    }
    .linha > div:first-child {
      flex: 0 0 200px;
      margin-right: 40px;
    }
    .linha > div:last-child {
      flex: 1;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    input[type="date"],
    input[readonly] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      background-color: #e9ecef;
      color: #495057;
    }
    input[type="date"]:not([readonly]) {
      background-color: white;
      color: black;
      cursor: pointer;
    }
    select,
    textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 12px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #218838;
    }
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #343a40;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 12px 0;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
      z-index: 1000;
    }
    footer button {
      width: auto;
      padding: 8px 20px;
      background-color: #007bff;
      margin: 0 10px;
      transition: background-color 0.3s ease;
    }
    footer button:hover {
      background-color: #0056b3;
    }
    /* Estilo erro */
    .error {
      border-color: #dc3545 !important;
      box-shadow: 0 0 5px #dc3545;
      animation: shake 0.3s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }
    .error-message {
      color: #dc3545;
      font-size: 14px;
      margin-top: -10px;
      margin-bottom: 10px;
      font-style: italic;
    }
    /* Checkbox group styling */
    #recepcionistas label {
      display: block;
      cursor: pointer;
      margin-bottom: 3px;
    }
    #recepcionistas {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      max-height: 150px;
      overflow-y: auto;
      background: #fafafa;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <div class="container" id="formContainer">

    <div class="cabecalho">
      <img src="https://www.alphainstituto.com.br/wp-content/uploads/2019/03/cropped-logo2-1.jpg" alt="Alpha Instituto" />
      <h2>Preencher Escala Diária</h2>
      <img src="https://www.mairiporaeducasim.com.br/assets/img/prefeitura-mairipora.png" alt="Prefeitura de Mairiporã" />
    </div>

    <form id="formEscala" novalidate>

      <div class="linha">
        <div>
          <label for="data">Data:</label>
          <input type="date" id="data" />
          <div class="error-message" id="error-data" style="display:none;">Por favor, preencha a data.</div>
        </div>

        <div>
          <label for="setor">Setor:</label>
          <input type="text" id="setor" value="Recepção" readonly />
        </div>
      </div>

      <label for="turno">Turno:</label>
      <select id="turno">
        <option value="">Selecione o turno</option>
        <option value="Diurno">Diurno</option>
        <option value="Noturno">Noturno</option>
      </select>
      <div class="error-message" id="error-turno" style="display:none;">Por favor, selecione o turno.</div>

      <label>Recepcionistas / Ambulância:</label>
      <div id="recepcionistas"></div>
      <div class="error-message" id="error-recepcionista" style="display:none;">Selecione pelo menos um recepcionista.</div>

      <label for="responsavel_remocao">Responsável pela Remoção:</label>
      <select id="responsavel_remocao">
        <option value="">Selecione...</option>
      </select>
      <div class="error-message" id="error-remocao" style="display:none;">Selecione o responsável pela remoção.</div>

      <label for="supervisor">Supervisor Responsável:</label>
      <select id="supervisor">
        <option value="">Selecione...</option>
      </select>
      <div class="error-message" id="error-supervisor" style="display:none;">Selecione o supervisor responsável.</div>

      <button type="submit">Salvar e Visualizar Painel</button>
    </form>
  </div>

  <footer>
    <button onclick="window.location.href='index.html'">Voltar ao Início</button>
  </footer>

  <script>
    const nomesRecepcionistas = [
      "Gabriele",
      "Damony",
      "Melissa",
      "Tatiane",
      "Cris",
      "Patricia",
      "Anna"
    ];

    const nomesSupervisao = [
      "Tamara",
      "Alessandra",
      "Andreia",
      "Valeria"
    ];

    // Responsável pela remoção (ambulância) mesma lista de recepcionistas
    const nomesRemocao = nomesRecepcionistas;

    const containerRecep = document.getElementById("recepcionistas");
    const selRemocao = document.getElementById("responsavel_remocao");
    const selSupervisor = document.getElementById("supervisor");
    const form = document.getElementById("formEscala");

    function criarCheckboxes(container, nomes) {
      container.innerHTML = "";
      nomes.forEach((nome, i) => {
        const label = document.createElement("label");
        label.htmlFor = `recep_${i}`;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `recep_${i}`;
        checkbox.value = nome;

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(" " + nome));
        container.appendChild(label);
      });
    }

    function popularSelect(select, opcoes) {
      select.innerHTML = '<option value="">Selecione...</option>';
      opcoes.forEach(nome => {
        const option = document.createElement("option");
        option.value = nome;
        option.textContent = nome;
        select.appendChild(option);
      });
    }

    criarCheckboxes(containerRecep, nomesRecepcionistas);
    popularSelect(selRemocao, nomesRemocao);
    popularSelect(selSupervisor, nomesSupervisao);

    // Carregar dados salvos
    const dados = JSON.parse(localStorage.getItem("escalaDiaria"));
    if (dados) {
      document.getElementById("data").value = dados.data || "";
      document.getElementById("setor").value = dados.setor || "Recepção";
      document.getElementById("turno").value = dados.turno || "";

      if (dados.recepcionistas) {
        const selecionados = dados.recepcionistas.split("\n");
        containerRecep.querySelectorAll("input[type=checkbox]").forEach(cb => {
          cb.checked = selecionados.includes(cb.value);
        });
      }

      for (const option of selRemocao.options) {
        if (option.value === (dados.responsavelRemocao || "")) option.selected = true;
      }

      for (const option of selSupervisor.options) {
        if (option.value === (dados.supervisor || "")) option.selected = true;
      }
    }

    function mostrarErro(idElemento, mostrar) {
      const el = document.getElementById(idElemento);
      el.style.display = mostrar ? "block" : "none";
    }

    function marcarErro(element, marcar) {
      if (marcar) {
        element.classList.add("error");
        element.scrollIntoView({behavior:"smooth", block:"center"});
      } else {
        element.classList.remove("error");
      }
    }

    // Limpar erros ao interagir
    document.getElementById("data").addEventListener("input", () => {
      marcarErro(document.getElementById("data"), false);
      mostrarErro("error-data", false);
    });
    document.getElementById("turno").addEventListener("change", () => {
      marcarErro(document.getElementById("turno"), false);
      mostrarErro("error-turno", false);
    });
    containerRecep.addEventListener("change", () => {
      marcarErro(containerRecep, false);
      mostrarErro("error-recepcionista", false);
    });
    selRemocao.addEventListener("change", () => {
      marcarErro(selRemocao, false);
      mostrarErro("error-remocao", false);
    });
    selSupervisor.addEventListener("change", () => {
      marcarErro(selSupervisor, false);
      mostrarErro("error-supervisor", false);
    });

    form.addEventListener("submit", e => {
      e.preventDefault();

      let valido = true;

      // Data
      const dataEl = document.getElementById("data");
      if (!dataEl.value.trim()) {
        marcarErro(dataEl, true);
        mostrarErro("error-data", true);
        valido = false;
      } else {
        marcarErro(dataEl, false);
        mostrarErro("error-data", false);
      }

      // Turno
      const turnoEl = document.getElementById("turno");
      if (!turnoEl.value.trim()) {
        marcarErro(turnoEl, true);
        mostrarErro("error-turno", true);
        valido = false;
      } else {
        marcarErro(turnoEl, false);
        mostrarErro("error-turno", false);
      }

      // Recepcionistas
      const recepSelecionados = Array.from(containerRecep.querySelectorAll("input[type=checkbox]:checked"));
      if (recepSelecionados.length === 0) {
        marcarErro(containerRecep, true);
        mostrarErro("error-recepcionista", true);
        valido = false;
      } else {
        marcarErro(containerRecep, false);
        mostrarErro("error-recepcionista", false);
      }

      // Responsável Remoção
      if (!selRemocao.value.trim()) {
        marcarErro(selRemocao, true);
        mostrarErro("error-remocao", true);
        valido = false;
      } else {
        marcarErro(selRemocao, false);
        mostrarErro("error-remocao", false);
      }

      // Supervisor
      if (!selSupervisor.value.trim()) {
        marcarErro(selSupervisor, true);
        mostrarErro("error-supervisor", true);
        valido = false;
      } else {
        marcarErro(selSupervisor, false);
        mostrarErro("error-supervisor", false);
      }

      if (!valido) return;

      // Grava e redireciona
      const recepTexto = recepSelecionados.map(cb => cb.value).join("\n");

      const escala = {
        data: dataEl.value,
        setor: document.getElementById("setor").value,
        turno: turnoEl.value,
        recepcionistas: recepTexto,
        responsavelRemocao: selRemocao.value,
        supervisor: selSupervisor.value
      };

      localStorage.setItem("escalaDiaria", JSON.stringify(escala));

      const container = document.getElementById("formContainer");
      container.style.transition = "opacity 0.5s ease";
      container.style.opacity = "0.5";

      setTimeout(() => {
        window.location.href = "painel.html";
      }, 500);
    });
  </script>

</body>
</html>
